{% extends 'base.html.twig' %}

{% block body %}
<div class="mb-4">
    <span class="badge bg-info">{{ game.year|date("Y") }}</span>
    <span class="badge {% if game_users|length == 0 %}bg-warning{% else %}bg-secondary{% endif %}">{% if game_users %}{{ game_users|length }} {% if game_users|length > 1 %}joueurs{% else %}joueur{% endif %}{% else %}0 joueur{% endif %}</span>
    <span class="badge {% if game.isOpenBets %}bg-success{% else %}bg-danger{% endif %}">{% if game.isOpenBets %}Paris ouverts{% else %}Paris fermés{% endif %}</span>
</div>

{% if results %}
    <div class="table-responsive">
        <table class="table table-hover mb-5">
            <thead>
                <tr>
                    <th>Classement</th>
                    <th>Joueur</th>
                    <th>Points</th>
                </tr>
            </thead>
            <tbody>
                {% set ranking = 0 %}
                {% set ranking_points = 0 %}
                {% set show_ranking = true %}
                {% for user_id, points in results %}
                    {% if ranking_points != points %}
                        {% set ranking = ranking + 1 %}
                        {% set ranking_points = points %}
                        {% set show_ranking = true %}
                    {% endif %}
                    <tr>
                        <td>{% if show_ranking %}# {{ ranking }}{% endif %}</td>
                        <td>{% if user_id in game_users|keys %}{{ game_users[user_id].login }}{% else %}{{ user_id }}{% endif %}</td>
                        <td>{{ points }}</td>
                    </tr>
                    {% set show_ranking = false %}
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p class="text-danger">Pas de classement disponible pour cette partie.</p>
{% endif %}

{% if bets and game_users %}
    {% for user in game_users %}
        <div class="card mb-3">
            <div class="card-body kikekane-card-title">
                <h5 class="card-title mb-0"><a href="{{ path('users_list') }}#user-{{ user.id }}">{{ user.login }}</a></h5>
            </div>
            {% if user.id in bets|keys %}
                <ul class="list-group list-group-flush kikekane-card-bets">
                {% for public_figure_id in bets[user.id] %}
                    <a class="list-group-item" href="{{ path('public_figures_list') }}#public-figure-{{ public_figure_id }}">
                        {% if public_figure_id in public_figures|keys %}
                            <span class="me-2">{{ public_figures[public_figure_id].name }}</span>
                            <span class="float-end">
                                {% if public_figures[public_figure_id].getDeathDate and public_figures[public_figure_id].getDeathDate|date("Y") == game.year|date("Y") %}
                                    <span class="badge bg-light text-dark">Trépassé en {{ game.year|date("Y") }}</span>
                                {% endif %}
                                {% if bonus['first_dead'] == public_figure_id %}
                                    <span class="badge bg-light text-dark">Bloody Kill (first)</span>
                                {% endif %}
                                {% if bonus['last_dead'] == public_figure_id %}
                                    <span class="badge bg-light text-dark">Bloody Kill (last)</span>
                                {% endif %}
                                {% if public_figure_id in bonus['solo'] %}
                                    <span class="badge bg-light text-dark">Solo</span>
                                {% endif %}
                                {% if public_figure_id in bonus['duo'] %}
                                    <span class="badge bg-light text-dark">Duo</span>
                                {% endif %}
                                {% if public_figures[public_figure_id].getAge == 27 %}
                                    <span class="badge bg-light text-dark">Club des 27</span>
                                {% endif %}
                            </span>
                        {% else %}
                            {{ public_figure_id }}
                        {% endif %}
                    </a>
                {% endfor %}
                </ul>
            {% else %}
                <div class="card-body pt-0 text-warning">
                    Pas de paris enregistrés pour ce joueur.
                </div>
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <p class="text-danger">Pas de paris enregistrés pour cette partie.</p>
{% endif %}
{% endblock %}